{% assign content_item = false %}
{% if post %}
{% assign content_item = post %}
{% else %}
{% assign content_item = page %}
{% endif %}

{% if page.url == '/' %}
{% assign is_index = true %}
{% else %}
{% assign is_index = false %}
{% endif %}

<div class="post">
    {% if content_item.is_archive %}
    {% else %}
    <div class="section section-post-meta post">
        {% if is_index %}
        <h2 {% if is_index == false %}id="main-heading"{% endif %}>
        {% else %}
        <h1 {% if is_index == false %}id="main-heading"{% endif %}>
        {% endif %}

        <a href="{{ content_item.url }}">
            {% if content_item.icon %}
            <i class="indicator-icon fa {{ content_item.icon }}"></i>
            {% else %}
            <i class="indicator-icon fa fa-bullhorn"></i>
            {% endif %}

            {{ content_item.title }}
        </a>

        {% comment %} Using a falsey comparison first allows for better IDE tag matching {% endcomment %}
        {% if is_index == false %}
            </h1>
        {% else %}
            </h2>
        {% endif %}

        <p class="meta">
            {{ content_item.date | date: "%B %e, %Y" }}
            {% if content_item.author %}
                by
                {% if content_item.author.url %}
                <a href="{{ content_item.author.url }}">{{ content_item.author.name }}</a>
                {% else %}
                {{ content_item.author.name }}
                {% endif %}
            {% endif %}
        </p>
    </div>
    {% endif %}

    {% if content_item.illustration %}
        {% if content_item.illustration.id %}
            <div class="section">
                {% if content_item.illustration.style %}
                    {% capture illustration_style %}{% endcapture %}

                    {% for style in content_item.illustration.style %}
                        {% capture illustration_style %}{{illustration_style}}{{style[0]}}: {{style[1]}};{% endcapture %}
                    {% endfor %}
                {% endif %}

                <div class="illustration illustration-{{ content_item.illustration.id }}">
                    <a href="/illustrations/{{ content_item.illustration.id }}"
                       style="background-image: url('{{ content_item.illustration.url }}');{{ illustration_style }}">
                        <i class="fa fa-search-plus"></i>
                    </a>
                </div>
            </div>
        {% else %}
            <div class="section">
                <div class="illustration illustration-{{ content_item.illustration.id }}" style="{% if content_item.illustration.height %} height: {{content_item.illustration.height}} {% endif %}">
                    <span style="background-image: url('{{ content_item.illustration.url }}'); {% if content_item.illustration.offset-x %}background-position-x: {{content_item.illustration.offset-x}};{% endif %}"></span>
                </div>
            </div>
        {% endif %}
    {% endif %}

    {% if content_item.layout == 'newsletter' %}
        {% include posts/newsletter/content.html %}
    {% else %}
    {{ content_item.content }}
    {% endif %}

    {% if page.url == '/' %}
        {% if content_item.continue_reading != false %}
    <div class="section section-continue-reading">
            <a href="{{ content_item.url }}" class="btn btn-default">Continue reading <i class="fa fa-caret-right"></i></a>
    </div>
        {% endif %}
    {% else %}
        {% if page.is_archive != true %}
    <div class="section comments">
        <i class="comment-icon fa fa-comments-o"></i>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            var disqus_config = function () {
                this.page.url = '{{ site.url}}{{page.url }}';  // Replace PAGE_URL with your page's canonical URL variable
                this.page.identifier = '{{ page.id }}'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
            };
            */
            (function() { // DON'T EDIT BELOW THIS LINE
                var d = document, s = d.createElement('script');
                s.src = 'https://simplytestable.disqus.com/embed.js';
                s.setAttribute('data-timestamp', +new Date());
                (d.head || d.body).appendChild(s);
            })();
        </script>
    </div>
        {% endif %}
    {% endif %}
</div>