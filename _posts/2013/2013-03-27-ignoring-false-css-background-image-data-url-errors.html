---
layout: default
title: "Ignoring False CSS Background Image Data Url Errors"
date: 2013-03-27 10:40 
author:
    name: Jon Cram
    url: http://webignition.net
---

<div class="section">
    <p>
        I learned yesterday from <a href="https://twitter.com/johnholtripley">@johnholtripley</a>        
        that CSS background image data URLs were presenting CSS validation errors incorrectly.
    </p>
    <p>
        By this I mean that the CSS validator was saying there is an error when there was not.
    </p>
    <p>
        Let me quickly explain what data URLs in CSS are for this to make sense.
    </p>
    <p>
        You can traditionally define a background image in CSS like this:
    </p>
    <pre><code>div.menu {
    background-image: url('elephant.png');
}</code></pre>
    <p>
        Modern browsers allow you to use data URLs whereby binary data is encoded
        within the URL itself:
    </p>
    <pre><code>div.menu {
    background-image: url(data:image/png;base64,iVBORw0KGgoAA
AANSUhEUgAAABAAAAAQAQMAAAAlPW0iAAAABlBMVEUAAAD///+l2Z/dAAAAM0l
EQVR4nGP4/5/h/1+G/58ZDrAz3D/McH8yw83NDDeNGe4Ug9C9zwz3gVLMDA/A6
P9/AFGGFyjOXZtQAAAAAElFTkSuQmCC);
}</code></pre>
    <p>(examples courtesy of <a href="http://en.wikipedia.org/wiki/Data_URI_scheme#CSS">Wikipedia</a>)</p>
    <p>
        A modern browser will then translate that long text string back in to
        binary data which will be, in this case, a png image.
    </p>
    <p>
        Take a look at the <code>url(...);</code> content above. See how
        it doesn't appear to be a regular URL as you know it?
    </p>
    <p>
        It doesn't look like a regular URL to me and, despite it being valid CSS,
        it doesn't look like a regular URL to the W3C CSS validator either.
    </p>
    <p>
        Try to validate the above and you get the lovely error:
    </p>
    <blockquote>
        Value Error : background-image url(data:image/png;base64,iVBORw0KGgoA&hellip;SuQmCC) is an incorrect URL
    </blockquote>
    <p>
        Notice how the <code>url(...);</code> content is directly in the brackets
        without quotes?
    </p>
    <p>
        You're allowed to use both <code>url("quoted");</code> and <code>url(unquoted);</code> 
        values (so long as you properly escape quote characters).
    </p>
    <p>
        Sadly the W3C CSS validator doesn't agree. Validation passes fine for
        quoted data URLs but not for valid unquoted data URLs.
    </p>
    <p>
        Luckily for you, I just updated our <a href="https://github.com/webignition/css-validator-output-parser">CSS validator parser library</a>
        to allow false background image data URL errors to be ignored.
    </p>
    <p>
        If you now <a href="http://gears.simplytestable.com/?html-validation=0&css-validation=1&css-validation-ignore-warnings=1&css-validation-ignore-common-cdns=1&css-validation-vendor-extensions=warn&js-static-analysis=0&website=blog.simplytestable.com">run a full-site CSS validation test</a>
        and happen to be using valid unquoted data URLs you'll no longer be bothered
        by such false errors.
    </p>    
</div>