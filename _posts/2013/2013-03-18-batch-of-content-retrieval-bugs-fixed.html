---
layout: default
title: "Batch of Content-Retrieval Bugs Fixed"
author:
    name: Jon Cram
    url: https://github.com/webignition
---

<div class="section">
    <p>
        Today has been focused on fixing bugs that just so happen to all relate
        to content retrieval.
    </p>
    <p>
        With the volumes of web pages retrieved and tested daily by Simply Testable,
        I always think I've seen all the ways in which people produce HTML incorrectly.
    </p>
    <p>
        With the volumes of code I write daily for Simply Testable I always think
        I've covered (nearly) all the ways in which content retrieval can go wrong.
    </p>
    <p>
        I'm still amazed by what I find.
    </p>
    <p>
        Today's latest bug fixes:
    </p>
    <h4>Fixed retrieval of JavaScript resources referenced by relative URLs</h4>
    <p>
        Ever referenced a JavaScript resource like this: <code>&lt;script src='../jquery.js'&gt;&lt;/script&gt;</code>
    </p>
    <p>
        We weren't correctly deriving the full absolute path to the referenced
        resource in some cases where a relative URL is used.
    </p>
    <p>
        Fixed.
    </p>
    <h4>Ignoring invalid Content-Type attributes</h4>
    <p>
        The HTTP Content-Type header includes details on the type of content
        present in a HTTP response.
    </p>
    <p>
        Here's a common example: <code>Content-Type: application/javascript; charset=UTF-8</code>.
    </p>
    <p>
        That example is perfectly correct. It tells us that the content we're getting
        is JavaScript and it tells us what character encoding to use when interpretting
        the JavaScript.
    </p>
    <p>
        Here's a bad example: <code>Content-Type: application/javascript; charset: UTF-8</code>.
    </p>
    <p>
        That example is invalid. It tells us, quite probably, that the content
        we're getting is JavaScript and it tells us that the &hellip; ahh, wait &hellip;
        what? &hellip; it contains nonsense from then onwards.
    </p>
    <p>
        Our <a href="https://github.com/webignition/internet-media-type">library for making sense of this</a>
        wasn't prepared for things being quite as invalid as the above bad example is.
    </p>
    <p>
        I updated the library to allow invalid attributes to be ignored entirely.
    </p>
    <p>
        Feel free now to return Content-Type headers with jibberish attributes if you fancy.
    </p>
    <p>
        Fixed.
    </p>
    <h4>Handling cURL Errors 6 and &hellip; 37</h4>
    <p>
        Somewhere towards the bottom of the stack when retrieving web content
        is a library called cURL. It gives us very detailed reasons why something
        went wrong if it went wrong.
    </p>
    <p>
        When retrieving some web pages and some JavaScript resources, things were
        going wrong. We weren't spotting them.
    </p>
    <p>
        It is now the case when retrieving a JavaScript resource to run through JSLint
        that all errors cURL can throw our way are handled gracefully.
    </p>
    <p>
        This specifically covers two cases of uncaught cURL errors that we were seeing.
    </p>
    <p>
        Firstly there is
        the quite-likely-to-occur error 6 which more or less translates to the fact
        that the domain name in a URL does not exist.
    </p>
    <p>
        Secondly there is
        the blimey-did-that-happen error 37 which occurs if you try to use a <code>file://</code>
        URL on the Internet.
    </p>
    <p>
        Feel free now to make such mistakes, I don't mind at all.
    </p>
    <p>
        Fixed.
    </p>
</div>