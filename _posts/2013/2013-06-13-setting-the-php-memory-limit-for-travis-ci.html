---
layout: default
title: "Setting the PHP Memory Limit for Travis CI"
author:
    name: Jon Cram
    url: https://github.com/webignition
excerpt_separator: <!--more-->
---

<div class="section">
    <h3>
        Introduction
    </h3>
    <p>
        I use <a href="https://travis-ci.org">Travis CI</a> as a secondary continuous
        integration (CI) service to help ensure that each Simply Testable application
        works in isolation as expected when code changes are made.
    </p>
    <p>
        Following some <a href="https://github.com/webignition/app.simplytestable.com/commit/adcb90035b2863c03f273fd150d9d5e8382d6b48">recent changes</a>
        I noticed that the <a href="https://travis-ci.org/webignition/app.simplytestable.com/jobs/8047559">PHP 5.3 build failed</a>
        due to it hitting a memory limit running unit tests.
    </p>

    <!--more-->

    <p>
        The most straightforward course of action: increase the PHP memory limit
        in the Travis environment.
    </p>
    <p>
        Each Travis build runs in a fresh virtual machine for which any form of shell
        access is not available. Simply finding and updating a configuration file
        isn't an option.
    </p>
    <p>
        Despite that, making the change is really easy. Here's what you do.
    </p>

</div>

<div class="section">
    <h3>
        Appending Any PHP Configuration Setting For Travis
    </h3>
    <p>
        Thankfully the Travis CI documentation is awesome and it provides
        a clear means of <a href="http://about.travis-ci.org/docs/user/languages/php/#Custom-PHP-configuration">appending the standard PHP configuration</a>
        with your own custom settings.
    </p>
    <p>
        We can use this to set the PHP memory limit.
    </p>
</div>

<div class="section">
    <h3>
        Setting the PHP Memory Limit for Travis CI
    </h3>
    <ol>
        <li>
            <h4>Create your custom ini file</h4>
            <p>
                I created a file named <code>travis.php.ini</code> in
                the root of my project (at the same level as <code>.travis.yml</code>.
            </p>
            <p>
                Name yours however you choose and put it within your project
                wherever you choose; the above is just an example.
                The important part is to note the relative path to your ini file.
            </p>
            <p>
                Add to your ini file any custom PHP configuration settings. These
                follow the same format as a regular php.ini file.
            </p>
            <p>
                I added just the following:
            </p>
            <pre>memory_limit = 1024M</pre>
        </li>
        <li>
            <h4>Update your project Travis configuration</h4>
            <p>
                You need to add <code>phpenv config-add &lt;relative path to your ini file&gt;</code>
                to the <code>before_script</code> section of your <code>.travis.yml</code>.
            </p>
            <p>
                Here's an abridged copy of my current .travis.yml to show what
                that looks like:
            </p>
            <pre>language: php
php:
  - 5.3
  - 5.4
  - 5.5

before_script:
  # Additional PHP config
  - phpenv config-add travis.php.ini

  # ... additional script lines

script:
  - phpunit -c app</pre>
            <p>
                So long as yours looks similar to the above but retains the ini
                file naming you chose you should be fine.
            </p>
        </li>
    </ol>
</div>